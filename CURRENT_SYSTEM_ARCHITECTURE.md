# í˜„ì¬ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œ
**ì˜ë£Œ ê°€ì´ë“œë¼ì¸ RAG ì„œë¹„ìŠ¤ - í˜„í™© ë¶„ì„**

ì‘ì„±ì¼: 2026-01-02
ë²„ì „: v2.0.0

---

## ğŸ“Š ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì 
ìˆ˜ì˜í•™ ë…¼ë¬¸ ë° ê°€ì´ë“œë¼ì¸ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ (RAG - Retrieval Augmented Generation)

### ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: FastAPI (Python)
- **Vector DB**: Pinecone (Serverless)
- **LLM**: OpenAI GPT-4o (ë‹µë³€ ìƒì„±), GPT-4o-mini (ë²ˆì—­/í™•ì¥)
- **Embedding**: OpenAI text-embedding-3-small (1536 ì°¨ì›)
- **Frontend**: React (ë³„ë„ ë¶„ì„ í•„ìš”)

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ í˜„í™©

### Pinecone Vector Database
- **ì¸ë±ìŠ¤ ì´ë¦„**: `medical-guidelines-kr` (í™˜ê²½ë³€ìˆ˜)
- **ì´ ë²¡í„° ìˆ˜**: ~1,218,400ê°œ ì²­í¬
- **ì„ë² ë”© ì°¨ì›**: 1536 (text-embedding-3-small)
- **ì›” ë¹„ìš©**: ~$90

### ë°ì´í„° ì†ŒìŠ¤ ë° ì²­í‚¹ ì „ëµ

#### 1. XML ë…¼ë¬¸ (PMC ì €ë„)
**ì²˜ë¦¬ëœ ì €ë„:**
- Veterinary Research: 6,171ê°œ ë…¼ë¬¸ â†’ 619,929ê°œ ì²­í¬
- BMC Veterinary Research: 4,729ê°œ ë…¼ë¬¸ â†’ 509,156ê°œ ì²­í¬
- Acta Veterinaria: 1,454ê°œ ë…¼ë¬¸ â†’ 89,315ê°œ ì²­í¬

**ì²­í‚¹ íŒŒë¼ë¯¸í„°** ([process_vetres_xml.py:211](../data-pipeline/process_vetres_xml.py#L211)):
```python
chunk_size = 600 characters
overlap = 150 characters (25% overlap)
min_chunk_size = 50 characters
```

**ì²­í‚¹ ë°©ë²•**: Recursive Chunking with Overlap
- ë¬¸ì¥ ê²½ê³„ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë¶„í•  (`. `, `.\n`, `\n\n`, `\n`, ` ` ìˆœì„œë¡œ íƒìƒ‰)
- êµ¬ë¶„ìë¥¼ ì°¾ì§€ ëª»í•˜ë©´ ê°•ì œ 600ì ë¶„í• 
- 50ì ë¯¸ë§Œ ì²­í¬ ì œì™¸

**ë©”íƒ€ë°ì´í„° êµ¬ì¡°**:
```json
{
  "doc_type": "paper",
  "title": "ë…¼ë¬¸ ì œëª©",
  "authors": "ì €ìëª… (6ëª… ì´ìƒì€ et al.)",
  "journal": "ì €ë„ëª…",
  "year": "ë°œí–‰ë…„ë„",
  "doi": "DOI",
  "pmcid": "PMC12345",
  "pmid": "PubMed ID",
  "page": "chunk_index (ì²­í¬ ë²ˆí˜¸)",
  "text": "ì²­í¬ ë³¸ë¬¸ (400-600ì)",
  "reference_format": "Authors. Journal. Year. doi:..."
}
```

#### 2. PDF ê°€ì´ë“œë¼ì¸ (ì¶”ì •)
- ë³„ë„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì²˜ë¦¬ (íŒŒì¼ ë¯¸í™•ì¸)
- PDF URL ë§¤í•‘ íŒŒì¼ ì¡´ì¬: `pdf_url_mapping.json`
- ë©”íƒ€ë°ì´í„° ë§¤í•‘: `pdf_metadata_mapping.json` (title â†’ filename)

---

## ğŸ”„ ì¿¼ë¦¬ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ (ì—”ë“œíˆ¬ì—”ë“œ)

### Phase 1: ì‚¬ìš©ì ì¿¼ë¦¬ ìˆ˜ì‹ 
**ì—”ë“œí¬ì¸íŠ¸**: `POST /query-stream` ([main.py:753](../backend/main.py#L753))

**ì…ë ¥ ë°ì´í„°**:
```json
{
  "question": "ì‚¬ìš©ì ì§ˆë¬¸",
  "conversation_history": [{"role": "user/assistant", "content": "..."}],
  "previous_context_chunks": [...], // ì´ì „ ëŒ€í™”ì˜ ì»¨í…ìŠ¤íŠ¸
  "language": "í•œêµ­ì–´ | English | æ—¥æœ¬èª"
}
```

### Phase 2: ì–¸ì–´ ê°ì§€ ë° ë²ˆì—­
([main.py:772-831](../backend/main.py#L772-L831))

**ì–¸ì–´ ê°ì§€ ìš°ì„ ìˆœìœ„**:
1. í”„ë¡ íŠ¸ì—”ë“œ ëª…ì‹œì  ì„ íƒ (request.language)
2. í…ìŠ¤íŠ¸ ê¸°ë°˜ ìë™ ê°ì§€ (ìœ ë‹ˆì½”ë“œ ë²”ìœ„ ë¶„ì„)
   - í•œê¸€: `0xAC00-0xD7A3`
   - ì¼ë³¸ì–´: íˆë¼ê°€ë‚˜/ì¹´íƒ€ì¹´ë‚˜/í•œì

**í•œêµ­ì–´ â†’ ì˜ì–´ ë²ˆì—­** (GPT-4o-mini ì‚¬ìš©):
- DBê°€ ì˜ì–´ë¡œ êµ¬ì¶•ë˜ì–´ ìˆì–´ ê²€ìƒ‰ ì „ ë²ˆì—­ í•„ìˆ˜
- **ë²ˆì—­ í”„ë¡¬í”„íŠ¸ íŠ¹ì§•** ([main.py:792-819](../backend/main.py#L792-L819)):
  - ì‹œê°„ì  ë§¥ë½ ë³´ì¡´: "ì•„ì¹¨ì—" â†’ "in the morning"
  - ì¦ìƒ í‘œí˜„ ë³´ì¡´: "ìš°ì›©ìš°ì›©" â†’ "retching", "ê±°í’ˆí† " â†’ "foamy vomit"
  - ìˆ˜ì˜í•™ ì „ë¬¸ ìš©ì–´ ë³€í™˜
  - Temperature: 0.2 (ì¼ê´€ì„± ìœ„í•´ ë‚®ê²Œ ì„¤ì •)

**SSE ì´ë²¤íŠ¸**: `{status: "translating", message: "ì§ˆë¬¸ ì´í•´ ì¤‘..."}`

---

### Phase 3: Query Expansion (ì¿¼ë¦¬ í™•ì¥)
([main.py:851-874](../backend/main.py#L851-L874))

**ëª©ì **: ê²€ìƒ‰ ì¬í˜„ìœ¨(recall) í–¥ìƒ

**í”„ë¡œì„¸ìŠ¤**:
1. ì›ë³¸ ë²ˆì—­ëœ ì˜ì–´ ì¿¼ë¦¬ ìœ ì§€
2. GPT-4o-minië¡œ 2ê°œ ëŒ€ì•ˆ ì¿¼ë¦¬ ìƒì„±
3. ì´ 3ê°œ ì¿¼ë¦¬ ì‚¬ìš© (ì›ë³¸ + 2ê°œ ëŒ€ì•ˆ)

**ì˜ˆì‹œ**:
```
ì›ë³¸: "My dog vomited foam in the morning"
í™•ì¥1: "What causes morning vomiting with foam in dogs?"
í™•ì¥2: "Canine regurgitation of frothy material at dawn"
```

**ëª¨ë¸**: GPT-4o-mini, Temperature: 0.7, Max tokens: 100

**SSE ì´ë²¤íŠ¸**: `{status: "embedding", message: "ë²¡í„° ë³€í™˜ ì¤‘..."}`

---

### Phase 4: ë²¡í„° ì„ë² ë”© ìƒì„±
([main.py:839-883](../backend/main.py#L839-L883))

**ì„ë² ë”© ëª¨ë¸**: `text-embedding-3-small` (OpenAI)
- ì°¨ì›: 1536
- ê° í™•ì¥ ì¿¼ë¦¬ë§ˆë‹¤ ì„ë² ë”© ìƒì„± (ì´ 3ê°œ ì„ë² ë”©)

```python
for exp_query in expanded_queries:  # 3ê°œ
    embedding = openai_client.embeddings.create(
        model="text-embedding-3-small",
        input=exp_query
    ).data[0].embedding
```

---

### Phase 5: Vector Search (Pinecone)
([main.py:886-917](../backend/main.py#L886-L917))

**ê²€ìƒ‰ ì „ëµ**: ë³‘ë ¬ ë‹¤ì¤‘ ì¿¼ë¦¬ ê²€ìƒ‰

**íŒŒë¼ë¯¸í„°**:
- **top_k = 15** (ê° ì¿¼ë¦¬ë‹¹)
- **include_metadata = True**
- **ì´ ê²€ìƒ‰ëŸ‰**: 3ê°œ ì¿¼ë¦¬ Ã— 15ê°œ = ìµœëŒ€ 45ê°œ ì²­í¬

**ì¤‘ë³µ ì œê±°**:
```python
chunk_id = f"{source}_{title}_{page}"
# ë™ì¼ ë¬¸ì„œì˜ ë™ì¼ í˜ì´ì§€ëŠ” 1ë²ˆë§Œ í¬í•¨
```

**ì¬ì •ë ¬**:
- ìœ ì‚¬ë„ ì ìˆ˜(cosine similarity) ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
- **ìƒìœ„ 25ê°œ ì²­í¬ ì„ íƒ**

**ì´ì „ ì»¨í…ìŠ¤íŠ¸ ë³‘í•©** ([main.py:919-933](../backend/main.py#L919-L933)):
- ì´ì „ ëŒ€í™”ì˜ ì»¨í…ìŠ¤íŠ¸ ì²­í¬ ì¤‘ ìµœëŒ€ 5ê°œ ì¶”ê°€
- ì¤‘ë³µ ì œê±° í›„ ë³‘í•©
- ìµœì¢… ì»¨í…ìŠ¤íŠ¸: ìµœëŒ€ ~30ê°œ ì²­í¬

**SSE ì´ë²¤íŠ¸**: `{status: "searching", message: "ë¬¸í—Œ ê²€ìƒ‰ ì¤‘..."}`

---

### Phase 6: ë‹µë³€ ìƒì„± (GPT-4o Streaming)
([main.py:286-676](../backend/main.py#L286-L676))

#### 6.1 ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
([main.py:306-310](../backend/main.py#L306-L310))

```python
context_text = "\n\n".join([
    f"Document {i}: {chunk.get('text', '')}"
    for i, chunk in enumerate(context_chunks[:25])
])
```

ê° ì²­í¬ë¥¼ "Document N" í˜•ì‹ìœ¼ë¡œ ë²ˆí˜¸ ë§¤ê¹€ (0-based)

#### 6.2 ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ íŠ¹ì§•
([main.py:313-443](../backend/main.py#L313-L443))

**í•µì‹¬ ì² í•™**: Evidence-Based Citation Engine
- "OpenEvidence ì² í•™": ë…¼ë¬¸ ë‚´ìš©ì„ ìµœì†Œí•œì˜ ì˜ì—­ìœ¼ë¡œ ì§ì ‘ ì¸ìš©
- ì¼ë°˜ ì§€ì‹ ì±—ë´‡ì´ ì•„ë‹Œ ê·¼ê±° ê¸°ë°˜ ì¶”ì¶œ ì‹œìŠ¤í…œ

**ì£¼ìš” ì§€ì‹œì‚¬í•­**:

1. **Citation Rules**:
   - ëª¨ë“  ì£¼ì¥ì— `{{citation:N}}` í˜•ì‹ìœ¼ë¡œ ì¶œì²˜ í‘œì‹œ
   - ë³µìˆ˜ ì¶œì²˜: `{{citation:0,1,2}}`
   - ë¬¸ì¥ ë¶€í˜¸ëŠ” citation **ì•ì—** ë°°ì¹˜: `"ë¬¸ì¥.{{citation:0}}"`
   - ìœ íš¨ ë²”ìœ„: 0 ~ (num_references-1)

2. **Follow-up Question Handling**:
   - ì´ì „ ë‹µë³€ ë°˜ë³µ ê¸ˆì§€
   - ë” ê¹Šì€ ë©”ì»¤ë‹ˆì¦˜, êµ¬ì²´ì  ì˜ˆì‹œ ì œê³µ
   - ì ì§„ì  ì •ë³´ ì¶”ê°€

3. **ì¹˜ë£Œ ì§ˆë¬¸ í•„ìˆ˜ ê·œì¹™**:
   - âœ… ì•½ë¬¼ëª… + ì •í™•í•œ ìš©ëŸ‰ + ê²½ë¡œ + ë¹ˆë„
   - âœ… ì˜ˆ: "Oclacitinib (Apoquel) at 0.4-0.6 mg/kg PO BID"
   - âŒ ê¸ˆì§€: "í•­íˆìŠ¤íƒ€ë¯¼ì œê°€ ì‚¬ìš©ë©ë‹ˆë‹¤" (ë„ˆë¬´ ëª¨í˜¸)

4. **í•œêµ­ì–´/ì¼ë³¸ì–´ ë‹µë³€ íŠ¹ìˆ˜ ê·œì¹™**:
   - ì˜í•™ ìš©ì–´ëŠ” ì²« ì–¸ê¸‰ ì‹œ ì˜ì–´ ë³‘ê¸°
   - ì˜ˆ: "ë‹´ì¦™ì„± êµ¬í†  ì¦í›„êµ°(Bilious vomiting syndrome, BVS)"
   - ì´í›„ ì•½ì–´ ë˜ëŠ” í•œêµ­ì–´ë§Œ ì‚¬ìš©

5. **ë‹µë³€ êµ¬ì¡°**:
   - ê¸°ë³¸: 3-5ê°œ ë‹¨ë½ (ê° 4-6 ë¬¸ì¥)
   - ê° ë‹¨ë½ ëì— citation
   - ì¤‘ìš” í¬ì¸íŠ¸ëŠ” **ë³¼ë“œ ë§ˆí¬ë‹¤ìš´**
   - í•„ìš”ì‹œ ë¹„êµ í…Œì´ë¸” ì‚¬ìš©

#### 6.3 ëŒ€í™” íˆìŠ¤í† ë¦¬
([main.py:449-453](../backend/main.py#L449-L453))

```python
for msg in conversation_history[-6:]:  # ìµœê·¼ 3í„´ (user+assistant)
    messages.append({
        "role": msg["role"],
        "content": msg["content"]
    })
```

ìµœê·¼ 6ê°œ ë©”ì‹œì§€ (3í„´) í¬í•¨í•˜ì—¬ ëŒ€í™” ë§¥ë½ ìœ ì§€

#### 6.4 GPT ëª¨ë¸ íŒŒë¼ë¯¸í„°
([main.py:524-530](../backend/main.py#L524-L530))

```python
model = "gpt-4o"
stream = True
temperature = 0.3  # ì¼ê´€ì„± ìˆëŠ” ë‹µë³€
max_tokens = 2000
```

#### 6.5 Streaming ì²˜ë¦¬
([main.py:532-676](../backend/main.py#L532-L676))

**Citation ë²„í¼ë§ ë¡œì§**:
- `{{citation:N}}` íŒ¨í„´ì´ ì™„ì„±ë  ë•Œê¹Œì§€ ë²„í¼ë§
- Partial citation ê°ì§€: `{{`, `{{c`, `{{ci`, ...
- ìœ íš¨ì„± ê²€ì¦: `0 <= N < num_references`
- ì˜ëª»ëœ citation ìë™ ì œê±°

**íƒ€ì´í•‘ íš¨ê³¼**: `await asyncio.sleep(0.01)` (10ms ë”œë ˆì´)

**SSE ì´ë²¤íŠ¸**:
```json
{
  "status": "streaming",
  "chunk": "í…ìŠ¤íŠ¸ ì¡°ê°..."
}
```

---

### Phase 7: ì°¸ê³ ë¬¸í—Œ ì¶”ì¶œ ë° ì¬ë§¤í•‘
([main.py:173-283](../backend/main.py#L173-L283))

#### 7.1 Citation ì¶”ì¶œ
```python
citations = extract_cited_indices(answer)
# ì˜ˆ: {{citation:0}}, {{citation:2,5,7}} â†’ {0, 2, 5, 7}
```

#### 7.2 Citation ì¬ë§¤í•‘
ì‹¤ì œ ì‚¬ìš©ëœ citationë§Œ 0ë¶€í„° ì¬ë²ˆí˜¸:

```python
cited_indices = {0, 5, 7, 12}
sorted_cited = [0, 5, 7, 12]
old_to_new = {0: 0, 5: 1, 7: 2, 12: 3}

# ë‹µë³€ì˜ {{citation:5}} â†’ {{citation:1}}ë¡œ ë³€ê²½
```

**ì´ìœ **: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì°¸ê³ ë¬¸í—Œ ëª©ë¡ì´ 0,1,2,3ìœ¼ë¡œ í‘œì‹œë˜ë¯€ë¡œ ë§¤ì¹­ í•„ìš”

#### 7.3 URL ìƒì„± ìš°ì„ ìˆœìœ„
([main.py:231-259](../backend/main.py#L231-L259))

1. **PMCID** â†’ `https://www.ncbi.nlm.nih.gov/pmc/articles/PMC12345/`
2. **PMID** â†’ `https://pubmed.ncbi.nlm.nih.gov/12345/`
3. **DOI** â†’ `https://doi.org/10.xxxx/xxxxx`
4. **PDF URL** â†’ `pdf_url_mapping.json`ì—ì„œ title ê¸°ë°˜ ê²€ìƒ‰

#### 7.4 Reference ê°ì²´ ìƒì„±

```python
Reference(
    title="ë…¼ë¬¸ ì œëª©",
    authors="ì €ìëª…",
    journal="ì €ë„ëª…",
    year="2024",
    doi="10.xxxx/xxxx",
    url="https://...",
    source="Veterinary Research",
    relevance_score=0.85  # Pinecone similarity score
)
```

**SSE ì´ë²¤íŠ¸**:
```json
{
  "status": "references_ready",
  "answer": "ì¬ë§¤í•‘ëœ ë‹µë³€ ({{citation:0,1,2}})",
  "references": [...]
}
```

---

### Phase 8: í›„ì† ì§ˆë¬¸ ìƒì„±
([main.py:678-726](../backend/main.py#L678-L726))

**ë³‘ë ¬ ì‹¤í–‰**: ì°¸ê³ ë¬¸í—Œ ì¶”ì¶œê³¼ ë™ì‹œ ì§„í–‰

**ëª¨ë¸**: GPT-4o-mini, Temperature: 0.7, Max tokens: 300

**í”„ë¡¬í”„íŠ¸ íŠ¹ì§•**:
- ë‹µë³€ì˜ êµ¬ì²´ì  ë‚´ìš© ê¸°ë°˜ (ì•½ë¬¼ëª…, ì‹œìˆ ëª…, ì†Œê²¬ ë“±)
- ì¼ë°˜ì  ì§ˆë¬¸ ê¸ˆì§€ ("ì¹˜ë£Œë²•ì€?", "ì›ì¸ì€?")
- ìˆ˜ì˜ì‚¬ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë¬¼ì„ ë²•í•œ 3ê°œ ì§ˆë¬¸ ìƒì„±

**ì˜ˆì‹œ**:
```
ë‹µë³€: "Oclacitinib (Apoquel) at 0.4-0.6 mg/kg PO BID is effective..."
í›„ì†ì§ˆë¬¸:
1. "Oclacitinibì˜ ì¥ê¸° ì‚¬ìš© ì‹œ ë¶€ì‘ìš©ì€ ë¬´ì—‡ì¸ê°€ìš”?"
2. "5kg ê³ ì–‘ì´ì—ê²Œ ì ì ˆí•œ Apoquel ìš©ëŸ‰ì€?"
3. "Oclacitinib ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëŒ€ì²´ ì•½ë¬¼ì€?"
```

**SSE ì´ë²¤íŠ¸**:
```json
{
  "status": "followup_ready",
  "followup_questions": ["ì§ˆë¬¸1", "ì§ˆë¬¸2", "ì§ˆë¬¸3"]
}
```

---

### Phase 9: ì™„ë£Œ
([main.py:997-1010](../backend/main.py#L997-L1010))

**SSE ì´ë²¤íŠ¸**:
```json
{
  "status": "done",
  "message": "ì™„ë£Œ",
  "context_chunks": [...]  // í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë‹¤ìŒ ëŒ€í™”ì— ì‚¬ìš©
}
```

---

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### ê²€ìƒ‰ ë‹¨ê³„
- **Query Expansion**: 3ê°œ ì¿¼ë¦¬ ë³‘ë ¬ ê²€ìƒ‰
- **Pinecone top_k**: 15 Ã— 3 = 45ê°œ í›„ë³´
- **ìµœì¢… ì»¨í…ìŠ¤íŠ¸**: 25-30ê°œ ì²­í¬
- **í‰ê·  ì²­í¬ í¬ê¸°**: 400-600ì
- **ì´ ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´**: ~10,000-18,000ì

### LLM ì‚¬ìš©ëŸ‰
1. **ë²ˆì—­** (í•œêµ­ì–´ ì§ˆë¬¸ ì‹œ): GPT-4o-mini, ~50 tokens
2. **Query Expansion**: GPT-4o-mini, ~100 tokens
3. **ë‹µë³€ ìƒì„±**: GPT-4o, ~2000 tokens (max)
4. **í›„ì† ì§ˆë¬¸**: GPT-4o-mini, ~300 tokens

**ì´ ë¹„ìš© (í•œ ì§ˆë¬¸ë‹¹, í•œêµ­ì–´ ê¸°ì¤€)**:
- ì„ë² ë”© (3íšŒ): ~$0.0001
- GPT-4o-mini (ë²ˆì—­+í™•ì¥+í›„ì†): ~$0.001
- GPT-4o (ë‹µë³€): ~$0.03-0.05
- **í•©ê³„**: ~$0.031-0.051 per query

---

## ğŸ” í˜„ì¬ ì•„í‚¤í…ì²˜ì˜ ê°•ì ê³¼ ì•½ì 

### âœ… ê°•ì 

1. **ë†’ì€ ì¬í˜„ìœ¨(Recall)**:
   - Query expansionìœ¼ë¡œ ë‹¤ì–‘í•œ í‘œí˜„ ì»¤ë²„
   - 25-30ê°œ ì²­í¬ë¡œ ë„“ì€ ì»¨í…ìŠ¤íŠ¸

2. **ì •í™•í•œ Citation**:
   - ìë™ ì¬ë§¤í•‘ìœ¼ë¡œ ì°¸ê³ ë¬¸í—Œ ì •í™•ì„± ë³´ì¥
   - ìŠ¤íŠ¸ë¦¬ë° ì¤‘ ìœ íš¨ì„± ê²€ì¦

3. **ë‹¤êµ­ì–´ ì§€ì›**:
   - í•œêµ­ì–´/ì¼ë³¸ì–´/ì˜ì–´ ë‹µë³€
   - ì˜í•™ ìš©ì–´ ì˜ì–´ ë³‘ê¸°ë¡œ ì •ë³´ ì†ì‹¤ ë°©ì§€

4. **UX ìµœì í™”**:
   - SSE ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì‹¤ì‹œê°„ í”¼ë“œë°±
   - í›„ì† ì§ˆë¬¸ ìë™ ìƒì„±

### âŒ ì•½ì  (10ë°° í™•ì¥ ì‹œ ë¬¸ì œì )

1. **ë¹„ìš© ê¸‰ì¦**:
   - Pinecone: $90/ì›” â†’ $900+/ì›” (10ë°°)
   - ì „ì²´ DB ê²€ìƒ‰ (1,200ë§Œ ë²¡í„°)

2. **ê²€ìƒ‰ í’ˆì§ˆ ì €í•˜**:
   - Top-k 15ë¡œëŠ” ê´€ë ¨ ë¬¸ì„œ ëˆ„ë½ ê°€ëŠ¥
   - ë©”íƒ€ë°ì´í„° í•„í„°ë§ ë¶€ì¬ (doc_type, animal_type ë“±)

3. **Latency ì¦ê°€**:
   - ëŒ€ê·œëª¨ ë²¡í„° ê²€ìƒ‰ ì‹œê°„ ì¦ê°€
   - Query expansion 3íšŒ ê²€ìƒ‰ìœ¼ë¡œ 3ë°° ë¶€í•˜

4. **ì •ë°€ë„(Precision) ë¬¸ì œ**:
   - 25-30ê°œ ì²­í¬ ì¤‘ ê´€ë ¨ ì—†ëŠ” ê²ƒ í¬í•¨ ê°€ëŠ¥
   - Reranking ë‹¨ê³„ ë¶€ì¬

5. **ë©”íƒ€ë°ì´í„° ì¤‘ë³µ**:
   - ê° ì²­í¬ë§ˆë‹¤ ë™ì¼ ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° ì €ì¥
   - ìŠ¤í† ë¦¬ì§€ ë‚­ë¹„ (50-70%)

---

## ğŸ¯ ê°œì„  ì œì•ˆ (ë‹¤ìŒ ë²„ì „ ê³ ë ¤ì‚¬í•­)

### ì œì•ˆëœ í•˜ì´ë¸Œë¦¬ë“œ ì•„í‚¤í…ì²˜

**BM25 (í‚¤ì›Œë“œ ê²€ìƒ‰) + Vector Search + Reranking**

```
[User Query]
     â†“
[Query Analysis & Translation]
     â†“
[BM25 Pre-filtering]
  - doc_type, animal_type í•„í„°
  - Abstract/Title í‚¤ì›Œë“œ ë§¤ì¹­
  â†’ 500-5,000ê°œ ë¬¸ì„œë¡œ ì¶•ì†Œ
     â†“
[Vector Search] (í•„í„°ë§ëœ doc_idë§Œ)
  - top_k = 50-100
     â†“
[Reranker] (Cross-Encoder)
  - top 10-15 ì„ íƒ
     â†“
[GPT Answer Generation]
```

**ì˜ˆìƒ íš¨ê³¼**:
- ë¹„ìš©: $90 â†’ $100-170 (BM25+Qdrant self-hosted)
- ì†ë„: ê²€ìƒ‰ ë²”ìœ„ ì¶•ì†Œë¡œ í–¥ìƒ
- ì •í™•ë„: Rerankingìœ¼ë¡œ ì •ë°€ë„ í–¥ìƒ
- í™•ì¥ì„±: 10ë°°, 100ë°°ë¡œë„ í™•ì¥ ê°€ëŠ¥

---

## ğŸ“ ì£¼ìš” íŒŒì¼ ìœ„ì¹˜

### Backend
- `backend/main.py`: FastAPI ë©”ì¸ ì„œë²„
- `backend/pdf_url_mapping.json`: PDF URL ë§¤í•‘
- `data-pipeline/pdf_metadata_mapping.json`: Title â†’ Filename ë§¤í•‘

### Data Pipeline
- `data-pipeline/process_vetres_xml.py`: XML ë…¼ë¬¸ ì²˜ë¦¬
- `data-pipeline/process_frontvet_xml.py`: Frontiers ì €ë„ ì²˜ë¦¬
- `data-pipeline/process_jvetsci_xml.py`: J Vet Sci ì €ë„ ì²˜ë¦¬
- `data-pipeline/vetres_processing_progress.json`: ì§„í–‰ ìƒí™© ì¶”ì 

### í™˜ê²½ ë³€ìˆ˜
- `OPENAI_API_KEY`: OpenAI API í‚¤
- `PINECONE_API_KEY`: Pinecone API í‚¤
- `PINECONE_INDEX_NAME`: "medical-guidelines-kr"

---

## ğŸ“Š ìš”ì•½ í”Œë¡œìš°ì°¨íŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ì§ˆë¬¸    â”‚ (í•œêµ­ì–´/ì¼ë³¸ì–´/ì˜ì–´)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì–¸ì–´ ê°ì§€      â”‚
â”‚  í•œâ†’ì˜ ë²ˆì—­     â”‚ (GPT-4o-mini, temp=0.2)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query Expansion â”‚ (ì›ë³¸ + 2ê°œ ëŒ€ì•ˆ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì„ë² ë”© ìƒì„±    â”‚ (text-embedding-3-small)
â”‚  3ê°œ ì¿¼ë¦¬       â”‚ (1536 dim Ã— 3)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pinecone ê²€ìƒ‰   â”‚ (top_k=15 Ã— 3 = 45ê°œ)
â”‚ + ì¤‘ë³µ ì œê±°     â”‚ â†’ ìƒìœ„ 25ê°œ ì„ íƒ
â”‚ + ì´ì „ ì»¨í…ìŠ¤íŠ¸ â”‚ â†’ ìµœëŒ€ ~30ê°œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GPT-4o ë‹µë³€ ìƒì„±â”‚ (temp=0.3, max=2000)
â”‚ (SSE Streaming) â”‚ {{citation:N}} í˜•ì‹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                 â”‚
         â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì°¸ê³ ë¬¸í—Œ ì¶”ì¶œ   â”‚ â”‚ í›„ì† ì§ˆë¬¸ ìƒì„±  â”‚
â”‚ Citation ì¬ë§¤í•‘ â”‚ â”‚ (GPT-4o-mini)   â”‚
â”‚ URL ìƒì„±        â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  ì™„ë£Œ (SSE)     â”‚
           â”‚  - answer       â”‚
           â”‚  - references   â”‚
           â”‚  - followups    â”‚
           â”‚  - context      â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ë¬¸ì„œ ì‘ì„±ì**: Claude Sonnet 4.5
**ë¶„ì„ ëŒ€ìƒ ì½”ë“œ**: `backend/main.py`, `data-pipeline/process_vetres_xml.py`
**ë‹¤ìŒ ë‹¨ê³„**: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„ ê³„íš ìˆ˜ë¦½
